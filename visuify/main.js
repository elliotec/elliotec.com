function authorize(){var t="http://localhost:4567/visuify",e="0b8f83c6a461499e88757164a5be5884",n="https://accounts.spotify.com/authorize?client_id="+e+"&response_type=token&redirect_uri="+t;return window.location.replace(n)}function addToGraph(t,e,n,r){return n.id=e.name,r.target=e.name,t.nodes.push(n),t.links.push(r),t}function buildGraph(t,e,n){var r=n||{nodes:[{id:t.name,uri:t.uri}],links:[]};return r=e.reduce(function(e,n){var a={id:n.name,uri:n.uri},i={source:t.name};return addToGraph(r,n,a,i)},r)}function getArtist(t){return $.ajax({url:"https://api.spotify.com/v1/search",data:{q:t,type:"artist"},headers:{Authorization:"Bearer "+accessToken}})}function getRelatedArtists(t){return $.ajax({url:"https://api.spotify.com/v1/artists/"+t+"/related-artists",headers:{Authorization:"Bearer "+accessToken}})}function getFirstDegreeArtists(t){t.artists.items.length||$("#message").text("\xaf\\_(\u30c4)_/\xaf Can't find that artist - try again.");var e=t.artists.items[0];return $("#uri").attr("href",e.uri).text($("#query").val()),$.when(e,getRelatedArtists(e.id).then(function(t){return t.artists}))}function getSecondDegreeArtists(t,e){var n=[$.when(t)];return e.forEach(function(t){var e=$.Deferred();n.push(e),getRelatedArtists(t.id).then(function(n){var r={};r[t.name]=n.artists,e.resolve(r)})}),$.when.apply(null,n)}function buildFirstGraph(t,e){return $.when(buildGraph(t,e),e)}function buildUpdatedGraph(t){var e=t,n=Array.prototype.slice.call(arguments,1);return n.forEach(function(n){e=buildGraph({name:Object.keys(n)[0]},n[Object.keys(n)[0]],t)}),e}function drawGraph(t){function e(){d.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),l.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y})}function n(t){d3.event.active||c.alphaTarget(.3).restart(),t.fx=t.x,t.fy=t.y}function r(t){t.fx=d3.event.x,t.fy=d3.event.y}function a(t){d3.event.active||c.alphaTarget(0),t.fx=null,t.fy=null}t.nodes=_.uniqBy(t.nodes,"id");var i=d3.select("svg"),s=parseInt(d3.select("#chart").style("width")),o=parseInt(d3.select("#chart").style("height")),c=d3.forceSimulation().force("link",d3.forceLink().id(function(t){return t.id})).force("charge",d3.forceManyBody().strength(-100)).force("center",d3.forceCenter(s/2,o/2.5)),u=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),d=i.append("g").attr("class","links").selectAll("line").data(t.links).enter().append("line").attr("stroke-width",2).on("mouseover",function(t){u.transition().duration(200).style("opacity",.9),u.html(t.source.id+" --- "+t.target.id).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(){u.transition().duration(500).style("opacity",0)}),l=i.append("g").attr("class","nodes").selectAll("circle").data(t.nodes).enter().append("circle").attr("r",8).attr("fill","#12121").on("mouseover",function(t){d3.select(this).transition().duration(200).attr("r",14),u.transition().duration(200).style("opacity",.9),u.html(t.id).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(){d3.select(this).transition().duration(200).attr("r",8),u.transition().duration(500).style("opacity",0)}).on("click",function(t){$("#query").val(t.id),u.transition().duration(500).style("opacity",0),visuify()}).call(d3.drag().on("start",n).on("drag",r).on("end",a));c.nodes(t.nodes).on("tick",e),c.force("link").links(t.links)}function visuify(){$("svg").empty(),$("#message").empty(),$("#uri").empty(),getArtist($("#query").val()).then(getFirstDegreeArtists).then(buildFirstGraph).then(getSecondDegreeArtists).then(buildUpdatedGraph).then(drawGraph)}function getHashValue(t){var e=location.hash.match(new RegExp(t+"=([^&]*)"));return e?e[1]:null}if($("#submit").on("click",function(t){t.preventDefault(),visuify()}),-1==window.location.href.indexOf("access_token"))authorize();else var accessToken=getHashValue("access_token");